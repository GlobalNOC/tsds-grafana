{"version":3,"sources":["../../src/query_ctrl.js"],"names":["GenericDatasourceQueryCtrl","$scope","$injector","uiSegmentSrv","scope","target","series","type","condition","groupby_field","metric_array","metricValues_array","aggregator","target_alias","whereClauseGroup","inlineGroupOperator","outerGroupOperator","percentileValue","bucket","bucketValue","drillDownAlias","index","parentIndex","hiddenIndex","drillDown","drillDownValue","self","push","splice","length","datasource","findOperator","console","log","findMetric","then","transformToSegments","metricFindTables","findWhereFields","arguments","r","generateDashboard","panelCtrl","ctrl","range","from","toISOString","to","dashboard","title","name","panel","window","location","reload","rawQuery","refresh","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv)  {\n    super($scope, $injector);\n\n    this.scope = $scope;\n    this.uiSegmentSrv = uiSegmentSrv;\n    this.target.series = this.target.series||'select table';\n    this.target.type = this.target.type || 'timeserie';\n    this.target.condition = this.target.condition||[];\n    //this.target.groupby_field = this.target.groupby_field||[]; \n    this.target.groupby_field = this.target.groupby_field ||' ';\n    this.target.metric_array = this.target.metric_array||['Select Metric'];\n    this.target.metricValues_array = this.target.metricValues_array ||['Select Metric Value'];\n    this.target.aggregator = this.target.aggregator ||['average'];\n    this.target.target_alias = this.target.target_alias||\"\";\n    this.target.whereClauseGroup = this.target.whereClauseGroup||[[{'left':'Select Metric','op':'','right':''}]];\n    this.target.inlineGroupOperator = this.target.inlineGroupOperator||[['']];\n    this.target.outerGroupOperator = this.target.outerGroupOperator || [''];\n    this.target.percentileValue = this.target.percentileValue||[''];\n    this.target.bucket = this.target.bucket||[];\n    this.target.bucketValue = this.target.bucketValue||[];\n    this.target.drillDownAlias = \"\";\n    this.index=\"\";\n    this.parentIndex=\"\";\n    this.hiddenIndex = \"\";\n    this.target.drillDown = [];\n    this.target.drillDownValue = [];\n    self = this;\n  }\n\n  addWhereClause(index){\n\t\tthis.target.whereClauseGroup[index].push({'left':'Select Metric','op':'=','right':''});\n  \t}\n\n removeWhereClause(parentIndex,index){\n\t\tthis.target.whereClauseGroup[parentIndex].splice(index,1);\n\t\tif (this.target.whereClauseGroup[parentIndex].length ==0 && parentIndex > 0){\n\t\t\tthis.target.whereClauseGroup.splice(parentIndex,1);\n\t\t}\n\n\t}\n\n  addWhereClauseGroup(){\n                this.target.whereClauseGroup.push([{'left':'Select Metric','op':'','right':''}]);\n\t\tthis.target.inlineGroupOperator.push(['']);\n        }\n\n    getOperator(){              \n       return this.datasource.findOperator();\n\t\n\t}\t\n  addSegments(){\n\t\tthis.target.metric_array.push('Select Metric');\n\t}\n\n removeSegment(index){\n\t\t\tthis.target.metric_array.splice(index,1);\n\t}\n\n  addValueSegments(){\n                this.target.metricValues_array.push('Select Metric Value');\n\t\tthis.target.aggregator.push('average');\n\t\tthis.target.percentileValue.push('');\n        } \n\n removeValueSegment(index){\n\t\tthis.target.metricValues_array.splice(index,1);\n\n\t}\n addGroupBy(){\n\t\tthis.target.groupby_field.push('Select Column');\n\t\tconsole.log(this.target.groupby_field);\n\t}\n\n removeGroupBy(index){\n\t\tthis.target.groupby_field.splice(index,1);\n\t}\n\n\n\n addBucket(index){\n\t\tthis.target.bucket.splice(index,0,'bucket');\n\t\tthis.target.bucketValue.splice(index,0,'');\n\t}\n\n  getColumns() {\n    return this.datasource.findMetric(this.target,\"Column\")\n      .then(this.uiSegmentSrv.transformToSegments(false));\n  }\n\n  getMetricValues() {\n    \treturn this.datasource.findMetric(this.target,\"Value\")\n      .then(this.uiSegmentSrv.transformToSegments(false));\n       }\n\n \n\n getTableNames() {\n    \treturn  this.datasource.metricFindTables(this.target)\n      .then(this.uiSegmentSrv.transformToSegments(false));\n        }\n\n getWhereFields(){\n    \treturn self.datasource.findWhereFields(self.target,self.parentIndex, self.index, arguments[0], arguments[1]);\n        }\n\ngenerateDrillDown(){\n\tthis.target.drillDown.splice(0,0,'Drill');\n}\n\n\ncreateDashboard(){\n\tvar r = this.datasource.generateDashboard(this.target, this.panelCtrl.$scope.ctrl.range.from.toISOString(), this.panelCtrl.$scope.ctrl.range.to.toISOString(),  this.panelCtrl.dashboard.title, this.datasource.name, this.panel.type);\n\twindow.location.reload();\n\treturn r;\n\n}\n saveIndices(parentIndex, index){\n        this.parentIndex = parentIndex;\n\tthis.index = index;\n\t}\n\n\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n onChangeInternal() {\n\tthis.panelCtrl.refresh();\n     }\n}\n\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}